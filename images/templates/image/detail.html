{% extends "base.html" %}
{% block title %}{{ image.title }}{% endblock %}
{% block content %}
<div class="flex justify-center min-h-screen py-6 " x-data="{ showLikes: false }">
    <div class="max-w-lg w-full ">
    <h1 class="text-3xl font-bold mb-6">{{ image.title }}</h1>
    <img src="{{ image.image.url }}" class="w-full max-w-2xl mx-auto rounded-lg shadow-lg mb-8" alt="{{ image.title }}">
    {% with total_likes=image.users_like.count %}
    <div class="bg-white p-6 rounded-lg shadow-md ">
        <div class="flex justify-between items-center mb-4">
            <span class="text-lg font-semibold">
                {{ total_likes }} like{{ total_likes|pluralize }}
            </span>
            <button 
                @click="showLikes = !showLikes" 
                class="font-bold py-2 px-4 text-green-600"
            >
                <span x-text="showLikes ? 'Hide Likes' : 'Show Likes'"></span>
            </button>
        </div>
        <div class="prose max-w-none">
            {{ image.description|linebreaks }}
        </div>
    </div>
    <div 
        x-show="showLikes" 
        x-transition:enter="transition ease-out duration-300"
        x-transition:enter-start="opacity-0 transform scale-90"
        x-transition:enter-end="opacity-100 transform scale-100"
        x-transition:leave="transition ease-in duration-300"
        x-transition:leave-start="opacity-100 transform scale-100"
        x-transition:leave-end="opacity-0 transform scale-90"
        class="mt-8 bg-gray-100 p-6 rounded-lg shadow-md"
    >
        <h2 class="text-2xl font-bold mb-4">Users who liked this image</h2>
        <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
            {% for user in image.users_like.all %}
            <div class="flex items-center space-x-2">
                {% if user.profile.photo %}
                <img src="{{ user.profile.photo.url }}" class="w-10 h-10 rounded-full" alt="{{ user.first_name }}">
                {% else %}
                <div class="w-10 h-10 rounded-full bg-gray-300 flex items-center justify-center">
                    <span class="text-gray-600 font-bold">{{ user.first_name|first }}</span>
                </div>
                {% endif %}
                <p class="font-medium">{{ user.first_name }}</p>
            </div>
            {% empty %}
            <p class="col-span-full text-gray-500 italic">Nobody likes this image yet.</p>
            {% endfor %}
        </div>
    </div>
    </div>
    {% endwith %}
</div>
{% endblock %}